{% extends 'base_with_map.html' %}
{% load l10n %}

{% block content %}
    <div class="post">
        <div class="date">
            <p>Автор: <a href="{% url 'profile' pk=place.author.pk %}"> {{ place.author }}</a>
        </div>
        <h1><a href="{% url 'user_places' pk=profile_user.pk %}">{{ places_header }}/ </a>{{ place.name }}</h1>
        <p>Координаты: {{place.latitude }}, {{ place.longitude }}</p>
        <p>{{ place.description|linebreaksbr }}</p>

        {% if place.deleted == False %}
            {% if user.is_authenticated and user == place.author %}
                <p><a href="{% url 'place_edit' pk=place.pk %}">редактировать</a>
                    <a href="{% url 'place_remove' pk=place.pk %}"> удалить</a></p>
            {% endif %}
            {% if user.is_staff and user != place.author %}
                <p><a href="{% url 'place_remove' pk=place.pk %}"> удалить</a></p>
            {% endif %}
        {% else %}
            <a href="{% url 'place_restore' pk=place.pk %}">Восстановить</a>
        {% endif %}

        {% if diary_list %}
            <h1>Записи, связанные с этим местом:</h1>
            {% for diary in diary_list %}
                <div>
                    <a href="{% url 'diary_detail' pk=diary.pk %}">{{ diary.name }}</a>&nbsp;
                    {{ diary.published_date }}&nbsp;
                    <a href="{% url 'diary_detail' pk=diary.pk %}#comments">{{ diary.comments_amount }}</a>&nbsp;
                    <b>{% if diary.deleted == True %} Удалён {% endif %}</b>
                </div>
            {% endfor %}
        {% else %}
            <h1>С этим местом пока не связана ни одна запись.</h1>
        {% endif %}
    </div>

    <div id="mapid" style="width: 600px; height: 400px;"></div>
    <script>

        var mymap = L.map('mapid').setView([{{ place.latitude|unlocalize }}, {{ place.longitude|unlocalize }}], 11);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(mymap);

        L.marker([{{ place.latitude|unlocalize }}, {{ place.longitude|unlocalize }}]).addTo(mymap)
        .bindPopup("{{ place.name }}").openPopup();


    </script>

{% endblock %}